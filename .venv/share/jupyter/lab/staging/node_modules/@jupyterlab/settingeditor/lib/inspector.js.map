{"version":3,"file":"inspector.js","sourceRoot":"","sources":["../../../../settingeditor/src/inspector.ts"],"names":[],"mappings":";AAAA;;;+EAG+E;;AAE/E,qDAAwE;AAExE,qDAA0E;AAE1E,uDAGgC;AAMhC;;GAEG;AACH,yBACE,MAAiB,EACjB,UAA+B;IAE/B,MAAM,SAAS,GAAG,IAAI,kBAAkB,CAAC,MAAM,CAAC,CAAC;IACjD,MAAM,SAAS,GAAG,IAAI,0BAAc,EAAE,CAAC;IACvC,MAAM,OAAO,GAAG,IAAI,6BAAiB,CAAC;QACpC,SAAS;QACT,UAAU,EACR,UAAU;YACV,IAAI,+BAAkB,CAAC;gBACrB,gBAAgB,EAAE,sCAAyB;aAC5C,CAAC;KACL,CAAC,CAAC;IAEH,SAAS,CAAC,GAAG,CAAC;QACZ,SAAS,EAAE,kBAAkB;QAC7B,IAAI,EAAE,OAAO;QACb,IAAI,EAAE,CAAC;QACP,IAAI,EAAE,OAAO;KACd,CAAC,CAAC;IACH,SAAS,CAAC,MAAM,GAAG,OAAO,CAAC;IAC3B,OAAO,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;IAE/B,OAAO,SAAS,CAAC;AACnB,CAAC;AAzBD,0CAyBC;AAED;;;;;;;GAOG;AACH,wBAAyB,SAAQ,yBAIhC;IACC,YAAY,MAAiB;QAC3B,KAAK,EAAE,CAAC;QAsCF,aAAQ,GAAG,CAAC,CAAC;QArCnB,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;IACxB,CAAC;IAED;;OAEG;IACH,KAAK,CACH,OAAmC;QAEnC,OAAO,IAAI,OAAO,CAA2B,OAAO,CAAC,EAAE;YACrD,wCAAwC;YACxC,MAAM,OAAO,GAAG,CAAC,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC,UAAU,CAAC,GAAG,EAAE;gBACtD,IAAI,OAAO,KAAK,IAAI,CAAC,QAAQ,EAAE;oBAC7B,OAAO,OAAO,CAAC,IAAI,CAAC,CAAC;iBACtB;gBAED,MAAM,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;gBAE5C,IAAI,CAAC,MAAM,EAAE;oBACX,OAAO,OAAO,CAAC,IAAI,CAAC,CAAC;iBACtB;gBAED,OAAO,CAAC,EAAE,IAAI,EAAE,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,QAAQ,EAAE,EAAE,EAAE,CAAC,CAAC;YAC1D,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;QACX,CAAC,CAAC,CAAC;IACL,CAAC;IAEO,SAAS,CAAC,GAAW;QAC3B,MAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;QAC5B,MAAM,IAAI,GAAG,EAAE,SAAS,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE,CAAC;QACzC,MAAM,EAAE,GAAG,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;QAClC,MAAM,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;QACtC,MAAM,SAAS,GAAG,MAAM,CAAC,QAAQ,CAAC,SAAS,CAAC;QAE5C,OAAO,SAAS,CAAC,YAAY,CAAC,EAAE,IAAI,EAAE,EAAE,EAAE,GAAG,EAAE,MAAM,EAAE,EAAE,KAAK,CAAC,CAAC;IAClE,CAAC;CAIF;AAED;;GAEG;AACH,IAAU,OAAO,CA2BhB;AA3BD,WAAU,OAAO;IACf;;OAEG;IACH,gBACE,MAAiC;QAEjC,OAAO,EAAE,eAAe,EAAE,MAAM,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC;IAC/D,CAAC;IAJe,cAAM,SAIrB,CAAA;IAED;;OAEG;IACH,qBAAqB,KAA8B;QACjD,QAAQ,KAAK,CAAC,OAAO,EAAE;YACrB,KAAK,sBAAsB;gBACzB,OAAO;cACD,KAAK,CAAC,MAAM,CAAC,kBAAkB,4BAA4B,CAAC;YACpE,KAAK,QAAQ;gBACX,OAAO,2BAA2B,KAAK,CAAC,OAAO,GAAG,CAAC;YACrD,KAAK,MAAM;gBACT,OAAO;cACD,KAAK,CAAC,QAAQ,MAAM,KAAK,CAAC,OAAO,EAAE,CAAC;YAC5C;gBACE,OAAO,oBAAoB,KAAK,CAAC,OAAO,GAAG,CAAC;SAC/C;IACH,CAAC;AACH,CAAC,EA3BS,OAAO,KAAP,OAAO,QA2BhB","sourcesContent":["/*-----------------------------------------------------------------------------\n| Copyright (c) Jupyter Development Team.\n| Distributed under the terms of the Modified BSD License.\n|----------------------------------------------------------------------------*/\n\nimport { DataConnector, ISchemaValidator } from '@jupyterlab/coreutils';\n\nimport { InspectionHandler, InspectorPanel } from '@jupyterlab/inspector';\n\nimport {\n  RenderMimeRegistry,\n  standardRendererFactories\n} from '@jupyterlab/rendermime';\n\nimport { ReadonlyJSONObject } from '@phosphor/coreutils';\n\nimport { RawEditor } from './raweditor';\n\n/**\n * Create a raw editor inspector.\n */\nexport function createInspector(\n  editor: RawEditor,\n  rendermime?: RenderMimeRegistry\n): InspectorPanel {\n  const connector = new InspectorConnector(editor);\n  const inspector = new InspectorPanel();\n  const handler = new InspectionHandler({\n    connector,\n    rendermime:\n      rendermime ||\n      new RenderMimeRegistry({\n        initialFactories: standardRendererFactories\n      })\n  });\n\n  inspector.add({\n    className: 'jp-SettingsDebug',\n    name: 'Debug',\n    rank: 0,\n    type: 'hints'\n  });\n  inspector.source = handler;\n  handler.editor = editor.source;\n\n  return inspector;\n}\n\n/**\n * The data connector used to populate a code inspector.\n *\n * #### Notes\n * This data connector debounces fetch requests to throttle them at no more than\n * one request per 100ms. This means that using the connector to populate\n * multiple client objects can lead to missed fetch responses.\n */\nclass InspectorConnector extends DataConnector<\n  InspectionHandler.IReply,\n  void,\n  InspectionHandler.IRequest\n> {\n  constructor(editor: RawEditor) {\n    super();\n    this._editor = editor;\n  }\n\n  /**\n   * Fetch inspection requests.\n   */\n  fetch(\n    request: InspectionHandler.IRequest\n  ): Promise<InspectionHandler.IReply> {\n    return new Promise<InspectionHandler.IReply>(resolve => {\n      // Debounce requests at a rate of 100ms.\n      const current = (this._current = window.setTimeout(() => {\n        if (current !== this._current) {\n          return resolve(null);\n        }\n\n        const errors = this._validate(request.text);\n\n        if (!errors) {\n          return resolve(null);\n        }\n\n        resolve({ data: Private.render(errors), metadata: {} });\n      }, 100));\n    });\n  }\n\n  private _validate(raw: string): ISchemaValidator.IError[] | null {\n    const editor = this._editor;\n    const data = { composite: {}, user: {} };\n    const id = editor.settings.plugin;\n    const schema = editor.settings.schema;\n    const validator = editor.registry.validator;\n\n    return validator.validateData({ data, id, raw, schema }, false);\n  }\n\n  private _current = 0;\n  private _editor: RawEditor;\n}\n\n/**\n * A namespace for private module data.\n */\nnamespace Private {\n  /**\n   * Render validation errors as an HTML string.\n   */\n  export function render(\n    errors: ISchemaValidator.IError[]\n  ): ReadonlyJSONObject {\n    return { 'text/markdown': errors.map(renderError).join('') };\n  }\n\n  /**\n   * Render an individual validation error as a markdown string.\n   */\n  function renderError(error: ISchemaValidator.IError): string {\n    switch (error.keyword) {\n      case 'additionalProperties':\n        return `**\\`[additional property error]\\`**\n          \\`${error.params.additionalProperty}\\` is not a valid property`;\n      case 'syntax':\n        return `**\\`[syntax error]\\`** *${error.message}*`;\n      case 'type':\n        return `**\\`[type error]\\`**\n          \\`${error.dataPath}\\` ${error.message}`;\n      default:\n        return `**\\`[error]\\`** *${error.message}*`;\n    }\n  }\n}\n"]}