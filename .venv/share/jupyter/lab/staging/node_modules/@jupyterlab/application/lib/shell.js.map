{"version":3,"file":"shell.js","sourceRoot":"","sources":["../../../../application/src/shell.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\n\nimport { ArrayExt, find, IIterator, iter, toArray } from '@phosphor/algorithm';\n\nimport { PromiseDelegate } from '@phosphor/coreutils';\n\nimport { Message, MessageLoop, IMessageHandler } from '@phosphor/messaging';\n\nimport { ISignal, Signal } from '@phosphor/signaling';\n\nimport {\n  BoxLayout,\n  BoxPanel,\n  DockLayout,\n  DockPanel,\n  FocusTracker,\n  Panel,\n  SplitPanel,\n  StackedPanel,\n  TabBar,\n  Title,\n  Widget\n} from '@phosphor/widgets';\n\nimport { DocumentRegistry } from '@jupyterlab/docregistry';\n\n/**\n * The class name added to AppShell instances.\n */\nconst APPLICATION_SHELL_CLASS = 'jp-ApplicationShell';\n\n/**\n * The class name added to side bar instances.\n */\nconst SIDEBAR_CLASS = 'jp-SideBar';\n\n/**\n * The class name added to the current widget's title.\n */\nconst CURRENT_CLASS = 'jp-mod-current';\n\n/**\n * The class name added to the active widget's title.\n */\nconst ACTIVE_CLASS = 'jp-mod-active';\n\n/**\n * The default rank of items added to a sidebar.\n */\nconst DEFAULT_RANK = 500;\n\n/**\n * The data attribute added to the document body indicating shell's mode.\n */\nconst MODE_ATTRIBUTE = 'data-shell-mode';\n\nconst ACTIVITY_CLASS = 'jp-Activity';\n\n/**\n * The application shell for JupyterLab.\n */\nexport class ApplicationShell extends Widget {\n  /**\n   * Construct a new application shell.\n   */\n  constructor() {\n    super();\n    this.addClass(APPLICATION_SHELL_CLASS);\n    this.id = 'main';\n\n    let bottomPanel = (this._bottomPanel = new BoxPanel());\n    let topPanel = (this._topPanel = new Panel());\n    let hboxPanel = (this._hboxPanel = new BoxPanel());\n    let dockPanel = (this._dockPanel = new DockPanel());\n    MessageLoop.installMessageHook(dockPanel, this._dockChildHook);\n\n    let hsplitPanel = (this._hsplitPanel = new SplitPanel());\n    let leftHandler = (this._leftHandler = new Private.SideBarHandler('left'));\n    let rightHandler = (this._rightHandler = new Private.SideBarHandler(\n      'right'\n    ));\n    let rootLayout = new BoxLayout();\n\n    bottomPanel.id = 'jp-bottom-panel';\n    topPanel.id = 'jp-top-panel';\n    hboxPanel.id = 'jp-main-content-panel';\n    dockPanel.id = 'jp-main-dock-panel';\n    hsplitPanel.id = 'jp-main-split-panel';\n\n    leftHandler.sideBar.addClass(SIDEBAR_CLASS);\n    leftHandler.sideBar.addClass('jp-mod-left');\n    leftHandler.stackedPanel.id = 'jp-left-stack';\n\n    rightHandler.sideBar.addClass(SIDEBAR_CLASS);\n    rightHandler.sideBar.addClass('jp-mod-right');\n    rightHandler.stackedPanel.id = 'jp-right-stack';\n\n    bottomPanel.direction = 'bottom-to-top';\n    hboxPanel.spacing = 0;\n    dockPanel.spacing = 5;\n    hsplitPanel.spacing = 1;\n\n    hboxPanel.direction = 'left-to-right';\n    hsplitPanel.orientation = 'horizontal';\n\n    SplitPanel.setStretch(leftHandler.stackedPanel, 0);\n    SplitPanel.setStretch(dockPanel, 1);\n    SplitPanel.setStretch(rightHandler.stackedPanel, 0);\n\n    BoxPanel.setStretch(leftHandler.sideBar, 0);\n    BoxPanel.setStretch(hsplitPanel, 1);\n    BoxPanel.setStretch(rightHandler.sideBar, 0);\n\n    hsplitPanel.addWidget(leftHandler.stackedPanel);\n    hsplitPanel.addWidget(dockPanel);\n    hsplitPanel.addWidget(rightHandler.stackedPanel);\n\n    hboxPanel.addWidget(leftHandler.sideBar);\n    hboxPanel.addWidget(hsplitPanel);\n    hboxPanel.addWidget(rightHandler.sideBar);\n\n    rootLayout.direction = 'top-to-bottom';\n    rootLayout.spacing = 0; // TODO make this configurable?\n\n    BoxLayout.setStretch(topPanel, 0);\n    BoxLayout.setStretch(hboxPanel, 1);\n    BoxLayout.setStretch(bottomPanel, 0);\n\n    rootLayout.addWidget(topPanel);\n    rootLayout.addWidget(hboxPanel);\n    rootLayout.addWidget(bottomPanel);\n\n    // initially hiding bottom panel when no elements inside\n    this._bottomPanel.hide();\n\n    this.layout = rootLayout;\n\n    // Connect change listeners.\n    this._tracker.currentChanged.connect(this._onCurrentChanged, this);\n    this._tracker.activeChanged.connect(this._onActiveChanged, this);\n\n    // Connect main layout change listener.\n    this._dockPanel.layoutModified.connect(this._onLayoutModified, this);\n\n    // Catch current changed events on the side handlers.\n    this._leftHandler.sideBar.currentChanged.connect(\n      this._onLayoutModified,\n      this\n    );\n    this._rightHandler.sideBar.currentChanged.connect(\n      this._onLayoutModified,\n      this\n    );\n  }\n\n  /**\n   * A signal emitted when main area's active focus changes.\n   */\n  get activeChanged(): ISignal<this, ApplicationShell.IChangedArgs> {\n    return this._activeChanged;\n  }\n\n  /**\n   * The active widget in the shell's main area.\n   */\n  get activeWidget(): Widget | null {\n    return this._tracker.activeWidget;\n  }\n\n  /**\n   * A signal emitted when main area's current focus changes.\n   */\n  get currentChanged(): ISignal<this, ApplicationShell.IChangedArgs> {\n    return this._currentChanged;\n  }\n\n  /**\n   * The current widget in the shell's main area.\n   */\n  get currentWidget(): Widget | null {\n    return this._tracker.currentWidget;\n  }\n\n  /**\n   * A signal emitted when the main area's layout is modified.\n   */\n  get layoutModified(): ISignal<this, void> {\n    return this._layoutModified;\n  }\n\n  /**\n   * Whether the left area is collapsed.\n   */\n  get leftCollapsed(): boolean {\n    return !this._leftHandler.sideBar.currentTitle;\n  }\n\n  /**\n   * Whether the left area is collapsed.\n   */\n  get rightCollapsed(): boolean {\n    return !this._rightHandler.sideBar.currentTitle;\n  }\n\n  /**\n   * Whether JupyterLab is in presentation mode with the `jp-mod-presentationMode` CSS class.\n   */\n  get presentationMode(): boolean {\n    return this.hasClass('jp-mod-presentationMode');\n  }\n\n  /**\n   * Enable/disable presentation mode (`jp-mod-presentationMode` CSS class) with a boolean.\n   */\n  set presentationMode(value: boolean) {\n    this.toggleClass('jp-mod-presentationMode', value);\n  }\n\n  /**\n   * The main dock area's user interface mode.\n   */\n  get mode(): DockPanel.Mode {\n    return this._dockPanel.mode;\n  }\n  set mode(mode: DockPanel.Mode) {\n    const dock = this._dockPanel;\n    if (mode === dock.mode) {\n      return;\n    }\n\n    const applicationCurrentWidget = this.currentWidget;\n\n    if (mode === 'single-document') {\n      this._cachedLayout = dock.saveLayout();\n      dock.mode = mode;\n\n      // In case the active widget in the dock panel is *not* the active widget\n      // of the application, defer to the application.\n      if (this.currentWidget) {\n        dock.activateWidget(this.currentWidget);\n      }\n\n      // Set the mode data attribute on the document body.\n      document.body.setAttribute(MODE_ATTRIBUTE, mode);\n      return;\n    }\n\n    // Cache a reference to every widget currently in the dock panel.\n    const widgets = toArray(dock.widgets());\n\n    // Toggle back to multiple document mode.\n    dock.mode = mode;\n\n    // Restore the original layout.\n    if (this._cachedLayout) {\n      // Remove any disposed widgets in the cached layout and restore.\n      Private.normalizeAreaConfig(dock, this._cachedLayout.main);\n      dock.restoreLayout(this._cachedLayout);\n      this._cachedLayout = null;\n    }\n\n    // Add any widgets created during single document mode, which have\n    // subsequently been removed from the dock panel after the multiple document\n    // layout has been restored. If the widget has add options cached for\n    // it (i.e., if it has been placed with respect to another widget),\n    // then take that into account.\n    widgets.forEach(widget => {\n      if (!widget.parent) {\n        this.addToMainArea(widget, {\n          ...this._addOptionsCache.get(widget),\n          activate: false\n        });\n      }\n    });\n    this._addOptionsCache.clear();\n\n    // In case the active widget in the dock panel is *not* the active widget\n    // of the application, defer to the application.\n    if (applicationCurrentWidget) {\n      dock.activateWidget(applicationCurrentWidget);\n    }\n\n    // Set the mode data attribute on the document body.\n    document.body.setAttribute(MODE_ATTRIBUTE, mode);\n  }\n\n  /**\n   * Promise that resolves when state is first restored, returning layout\n   * description.\n   */\n  get restored(): Promise<ApplicationShell.ILayout> {\n    return this._restored.promise;\n  }\n\n  /**\n   * Activate a widget in its area.\n   */\n  activateById(id: string): void {\n    if (this._leftHandler.has(id)) {\n      this._leftHandler.activate(id);\n      return;\n    }\n\n    if (this._rightHandler.has(id)) {\n      this._rightHandler.activate(id);\n      return;\n    }\n\n    const dock = this._dockPanel;\n    const widget = find(dock.widgets(), value => value.id === id);\n\n    if (widget) {\n      dock.activateWidget(widget);\n    }\n  }\n\n  /*\n   * Activate the next Tab in the active TabBar.\n  */\n  activateNextTab(): void {\n    let current = this._currentTabBar();\n    if (!current) {\n      return;\n    }\n\n    let ci = current.currentIndex;\n    if (ci === -1) {\n      return;\n    }\n\n    if (ci < current.titles.length - 1) {\n      current.currentIndex += 1;\n      if (current.currentTitle) {\n        current.currentTitle.owner.activate();\n      }\n      return;\n    }\n\n    if (ci === current.titles.length - 1) {\n      let nextBar = this._adjacentBar('next');\n      if (nextBar) {\n        nextBar.currentIndex = 0;\n        if (nextBar.currentTitle) {\n          nextBar.currentTitle.owner.activate();\n        }\n      }\n    }\n  }\n\n  /*\n   * Activate the previous Tab in the active TabBar.\n  */\n  activatePreviousTab(): void {\n    let current = this._currentTabBar();\n    if (!current) {\n      return;\n    }\n\n    let ci = current.currentIndex;\n    if (ci === -1) {\n      return;\n    }\n\n    if (ci > 0) {\n      current.currentIndex -= 1;\n      if (current.currentTitle) {\n        current.currentTitle.owner.activate();\n      }\n      return;\n    }\n\n    if (ci === 0) {\n      let prevBar = this._adjacentBar('previous');\n      if (prevBar) {\n        let len = prevBar.titles.length;\n        prevBar.currentIndex = len - 1;\n        if (prevBar.currentTitle) {\n          prevBar.currentTitle.owner.activate();\n        }\n      }\n    }\n  }\n\n  /**\n   * Add a widget to the left content area.\n   *\n   * #### Notes\n   * Widgets must have a unique `id` property, which will be used as the DOM id.\n   */\n  addToLeftArea(\n    widget: Widget,\n    options: ApplicationShell.ISideAreaOptions = {}\n  ): void {\n    if (!widget.id) {\n      console.error('Widgets added to app shell must have unique id property.');\n      return;\n    }\n    let rank = 'rank' in options ? options.rank : DEFAULT_RANK;\n    this._leftHandler.addWidget(widget, rank!);\n    this._onLayoutModified();\n  }\n\n  /**\n   * Add a widget to the main content area.\n   *\n   * #### Notes\n   * Widgets must have a unique `id` property, which will be used as the DOM id.\n   * All widgets added to the main area should be disposed after removal\n   * (disposal before removal will remove the widget automatically).\n   *\n   * In the options, `ref` defaults to `null`, `mode` defaults to `'tab-after'`,\n   * and `activate` defaults to `true`.\n   */\n  addToMainArea(\n    widget: Widget,\n    options: ApplicationShell.IMainAreaOptions = {}\n  ): void {\n    if (!widget.id) {\n      console.error('Widgets added to app shell must have unique id property.');\n      return;\n    }\n\n    let dock = this._dockPanel;\n\n    let ref: Widget | null = null;\n    if (options.ref) {\n      ref = find(dock.widgets(), value => value.id === options.ref!) || null;\n    }\n\n    let mode = options.mode || 'tab-after';\n\n    dock.addWidget(widget, { mode, ref });\n\n    // The dock panel doesn't account for placement information while\n    // in single document mode, so upon rehydrating any widgets that were\n    // added will not be in the correct place. Cache the placement information\n    // here so that we can later rehydrate correctly.\n    if (dock.mode === 'single-document') {\n      this._addOptionsCache.set(widget, options);\n    }\n\n    if (options.activate !== false) {\n      dock.activateWidget(widget);\n    }\n  }\n\n  /**\n   * Add a widget to the right content area.\n   *\n   * #### Notes\n   * Widgets must have a unique `id` property, which will be used as the DOM id.\n   */\n  addToRightArea(\n    widget: Widget,\n    options: ApplicationShell.ISideAreaOptions = {}\n  ): void {\n    if (!widget.id) {\n      console.error('Widgets added to app shell must have unique id property.');\n      return;\n    }\n    let rank = 'rank' in options ? options.rank : DEFAULT_RANK;\n    this._rightHandler.addWidget(widget, rank!);\n    this._onLayoutModified();\n  }\n\n  /**\n   * Add a widget to the top content area.\n   *\n   * #### Notes\n   * Widgets must have a unique `id` property, which will be used as the DOM id.\n   */\n  addToTopArea(\n    widget: Widget,\n    options: ApplicationShell.ISideAreaOptions = {}\n  ): void {\n    if (!widget.id) {\n      console.error('Widgets added to app shell must have unique id property.');\n      return;\n    }\n    // Temporary: widgets are added to the panel in order of insertion.\n    this._topPanel.addWidget(widget);\n    this._onLayoutModified();\n  }\n\n  /**\n   * Add a widget to the bottom content area.\n   *\n   * #### Notes\n   * Widgets must have a unique `id` property, which will be used as the DOM id.\n   */\n\n  addToBottomArea(\n    widget: Widget,\n    options: ApplicationShell.ISideAreaOptions = {}\n  ): void {\n    if (!widget.id) {\n      console.error('Widgets added to app shell must have unique id property.');\n      return;\n    }\n    // Temporary: widgets are added to the panel in order of insertion.\n    this._bottomPanel.addWidget(widget);\n    this._onLayoutModified();\n\n    if (this._bottomPanel.isHidden) {\n      this._bottomPanel.show();\n    }\n  }\n\n  /**\n   * Collapse the left area.\n   */\n  collapseLeft(): void {\n    this._leftHandler.collapse();\n    this._onLayoutModified();\n  }\n\n  /**\n   * Collapse the right area.\n   */\n  collapseRight(): void {\n    this._rightHandler.collapse();\n    this._onLayoutModified();\n  }\n\n  /**\n   * Expand the left area.\n   *\n   * #### Notes\n   * This will open the most recently used tab,\n   * or the first tab if there is no most recently used.\n   */\n  expandLeft(): void {\n    this._leftHandler.expand();\n    this._onLayoutModified();\n  }\n\n  /**\n   * Expand the right area.\n   *\n   * #### Notes\n   * This will open the most recently used tab,\n   * or the first tab if there is no most recently used.\n   */\n  expandRight(): void {\n    this._rightHandler.expand();\n    this._onLayoutModified();\n  }\n\n  /**\n   * Close all widgets in the main area.\n   */\n  closeAll(): void {\n    // Make a copy of all the widget in the dock panel (using `toArray()`)\n    // before removing them because removing them while iterating through them\n    // modifies the underlying data of the iterator.\n    toArray(this._dockPanel.widgets()).forEach(widget => widget.close());\n  }\n\n  /**\n   * True if the given area is empty.\n   */\n  isEmpty(area: ApplicationShell.Area): boolean {\n    switch (area) {\n      case 'left':\n        return this._leftHandler.stackedPanel.widgets.length === 0;\n      case 'main':\n        return this._dockPanel.isEmpty;\n      case 'top':\n        return this._topPanel.widgets.length === 0;\n      case 'bottom':\n        return this._bottomPanel.widgets.length === 0;\n      case 'right':\n        return this._rightHandler.stackedPanel.widgets.length === 0;\n      default:\n        return true;\n    }\n  }\n\n  /**\n   * Restore the layout state for the application shell.\n   */\n  restoreLayout(layout: ApplicationShell.ILayout): void {\n    const { mainArea, leftArea, rightArea } = layout;\n\n    // Rehydrate the main area.\n    if (mainArea) {\n      const { currentWidget, dock, mode } = mainArea;\n\n      if (dock) {\n        this._dockPanel.restoreLayout(dock);\n      }\n      if (mode) {\n        this.mode = mode;\n      }\n      if (currentWidget) {\n        this.activateById(currentWidget.id);\n      }\n    }\n\n    // Rehydrate the left area.\n    if (leftArea) {\n      this._leftHandler.rehydrate(leftArea);\n    }\n\n    // Rehydrate the right area.\n    if (rightArea) {\n      this._rightHandler.rehydrate(rightArea);\n    }\n\n    if (!this._isRestored) {\n      // Make sure all messages in the queue are finished before notifying\n      // any extensions that are waiting for the promise that guarantees the\n      // application state has been restored.\n      MessageLoop.flush();\n      this._restored.resolve(layout);\n    }\n  }\n\n  /**\n   * Save the dehydrated state of the application shell.\n   */\n  saveLayout(): ApplicationShell.ILayout {\n    // If the application is in single document mode, use the cached layout if\n    // available. Otherwise, default to querying the dock panel for layout.\n    return {\n      mainArea: {\n        currentWidget: this._tracker.currentWidget,\n        dock:\n          this.mode === 'single-document'\n            ? this._cachedLayout || this._dockPanel.saveLayout()\n            : this._dockPanel.saveLayout(),\n        mode: this._dockPanel.mode\n      },\n      leftArea: this._leftHandler.dehydrate(),\n      rightArea: this._rightHandler.dehydrate()\n    };\n  }\n\n  /**\n   * Returns the widgets for an application area.\n   */\n  widgets(area: ApplicationShell.Area): IIterator<Widget> {\n    switch (area) {\n      case 'main':\n        return this._dockPanel.widgets();\n      case 'left':\n        return iter(this._leftHandler.sideBar.titles.map(t => t.owner));\n      case 'right':\n        return iter(this._rightHandler.sideBar.titles.map(t => t.owner));\n      case 'top':\n        return this._topPanel.children();\n      case 'bottom':\n        return this._bottomPanel.children();\n      default:\n        throw new Error('Invalid area');\n    }\n  }\n\n  /**\n   * Handle `after-attach` messages for the application shell.\n   */\n  protected onAfterAttach(msg: Message): void {\n    document.body.setAttribute(MODE_ATTRIBUTE, this.mode);\n  }\n\n  /*\n   * Return the tab bar adjacent to the current TabBar or `null`.\n   */\n  private _adjacentBar(direction: 'next' | 'previous'): TabBar<Widget> | null {\n    const current = this._currentTabBar();\n    if (!current) {\n      return null;\n    }\n\n    const bars = toArray(this._dockPanel.tabBars());\n    const len = bars.length;\n    const index = bars.indexOf(current);\n\n    if (direction === 'previous') {\n      return index > 0 ? bars[index - 1] : index === 0 ? bars[len - 1] : null;\n    }\n\n    // Otherwise, direction is 'next'.\n    return index < len - 1\n      ? bars[index + 1]\n      : index === len - 1 ? bars[0] : null;\n  }\n\n  /*\n   * Return the TabBar that has the currently active Widget or null.\n   */\n  private _currentTabBar(): TabBar<Widget> | null {\n    const current = this._tracker.currentWidget;\n    if (!current) {\n      return null;\n    }\n\n    const title = current.title;\n    const bars = this._dockPanel.tabBars();\n    return find(bars, bar => bar.titles.indexOf(title) > -1) || null;\n  }\n\n  /**\n   * Handle a change to the dock area active widget.\n   */\n  private _onActiveChanged(\n    sender: any,\n    args: FocusTracker.IChangedArgs<Widget>\n  ): void {\n    if (args.newValue) {\n      args.newValue.title.className += ` ${ACTIVE_CLASS}`;\n    }\n    if (args.oldValue) {\n      args.oldValue.title.className = args.oldValue.title.className.replace(\n        ACTIVE_CLASS,\n        ''\n      );\n    }\n    this._activeChanged.emit(args);\n  }\n\n  /**\n   * Handle a change to the dock area current widget.\n   */\n  private _onCurrentChanged(\n    sender: any,\n    args: FocusTracker.IChangedArgs<Widget>\n  ): void {\n    if (args.newValue) {\n      args.newValue.title.className += ` ${CURRENT_CLASS}`;\n    }\n    if (args.oldValue) {\n      args.oldValue.title.className = args.oldValue.title.className.replace(\n        CURRENT_CLASS,\n        ''\n      );\n    }\n    this._currentChanged.emit(args);\n    this._onLayoutModified();\n  }\n\n  /**\n   * Handle a change to the layout.\n   */\n  private _onLayoutModified(): void {\n    // The dock can emit layout modified signals while in transient\n    // states (for instance, when switching from single-document to\n    // multiple-document mode). In those states, it can be unreliable\n    // for the signal consumers to query layout properties.\n    // We fix this by debouncing the layout modified signal so that it\n    // is only emitted after rearranging is done.\n    window.clearTimeout(this._debouncer);\n    this._debouncer = window.setTimeout(() => {\n      this._layoutModified.emit(undefined);\n    }, 0);\n  }\n\n  /**\n   * A message hook for child add/remove messages on the main area dock panel.\n   */\n  private _dockChildHook = (\n    handler: IMessageHandler,\n    msg: Message\n  ): boolean => {\n    switch (msg.type) {\n      case 'child-added':\n        (msg as Widget.ChildMessage).child.addClass(ACTIVITY_CLASS);\n        this._tracker.add((msg as Widget.ChildMessage).child);\n        break;\n      case 'child-removed':\n        (msg as Widget.ChildMessage).child.removeClass(ACTIVITY_CLASS);\n        this._tracker.remove((msg as Widget.ChildMessage).child);\n        break;\n      default:\n        break;\n    }\n    return true;\n  };\n\n  private _activeChanged = new Signal<this, ApplicationShell.IChangedArgs>(\n    this\n  );\n  private _cachedLayout: DockLayout.ILayoutConfig | null = null;\n  private _currentChanged = new Signal<this, ApplicationShell.IChangedArgs>(\n    this\n  );\n  private _dockPanel: DockPanel;\n  private _hboxPanel: BoxPanel;\n  private _hsplitPanel: SplitPanel;\n  private _isRestored = false;\n  private _layoutModified = new Signal<this, void>(this);\n  private _leftHandler: Private.SideBarHandler;\n  private _restored = new PromiseDelegate<ApplicationShell.ILayout>();\n  private _rightHandler: Private.SideBarHandler;\n  private _tracker = new FocusTracker<Widget>();\n  private _topPanel: Panel;\n  private _bottomPanel: Panel;\n  private _debouncer = 0;\n  private _addOptionsCache = new Map<\n    Widget,\n    ApplicationShell.IMainAreaOptions\n  >();\n}\n\n/**\n * The namespace for `ApplicationShell` class statics.\n */\nexport namespace ApplicationShell {\n  /**\n   * The areas of the application shell where widgets can reside.\n   */\n  export type Area = 'main' | 'top' | 'left' | 'right' | 'bottom';\n\n  /**\n   * The restorable description of an area within the main dock panel.\n   */\n  export type AreaConfig = DockLayout.AreaConfig;\n\n  /**\n   * An arguments object for the changed signals.\n   */\n  export type IChangedArgs = FocusTracker.IChangedArgs<Widget>;\n\n  /**\n   * A description of the application's user interface layout.\n   */\n  export interface ILayout {\n    /**\n     * Indicates whether fetched session restore data was actually retrieved\n     * from the state database or whether it is a fresh blank slate.\n     *\n     * #### Notes\n     * This attribute is only relevant when the layout data is retrieved via a\n     * `fetch` call. If it is set when being passed into `save`, it will be\n     * ignored.\n     */\n    readonly fresh?: boolean;\n\n    /**\n     * The main area of the user interface.\n     */\n    readonly mainArea: IMainArea | null;\n\n    /**\n     * The left area of the user interface.\n     */\n    readonly leftArea: ISideArea | null;\n\n    /**\n     * The right area of the user interface.\n     */\n    readonly rightArea: ISideArea | null;\n  }\n\n  /**\n   * The restorable description of the main application area.\n   */\n  export interface IMainArea {\n    /**\n     * The current widget that has application focus.\n     */\n    readonly currentWidget: Widget | null;\n\n    /**\n     * The contents of the main application dock panel.\n     */\n    readonly dock: DockLayout.ILayoutConfig | null;\n\n    /**\n     * The document mode (i.e., multiple/single) of the main dock panel.\n     */\n    readonly mode: DockPanel.Mode | null;\n  }\n\n  /**\n   * The restorable description of a sidebar in the user interface.\n   */\n  export interface ISideArea {\n    /**\n     * A flag denoting whether the sidebar has been collapsed.\n     */\n    readonly collapsed: boolean;\n\n    /**\n     * The current widget that has side area focus.\n     */\n    readonly currentWidget: Widget | null;\n\n    /**\n     * The collection of widgets held by the sidebar.\n     */\n    readonly widgets: Array<Widget> | null;\n  }\n\n  /**\n   * The options for adding a widget to a side area of the shell.\n   */\n  export interface ISideAreaOptions {\n    /**\n     * The rank order of the widget among its siblings.\n     */\n    rank?: number;\n  }\n\n  /**\n   * The options for adding a widget to a side area of the shell.\n   */\n  export interface IMainAreaOptions extends DocumentRegistry.IOpenOptions {}\n}\n\nnamespace Private {\n  /**\n   * An object which holds a widget and its sort rank.\n   */\n  export interface IRankItem {\n    /**\n     * The widget for the item.\n     */\n    widget: Widget;\n\n    /**\n     * The sort rank of the widget.\n     */\n    rank: number;\n  }\n\n  /**\n   * A less-than comparison function for side bar rank items.\n   */\n  export function itemCmp(first: IRankItem, second: IRankItem): number {\n    return first.rank - second.rank;\n  }\n\n  /**\n   * Removes widgets that have been disposed from an area config, mutates area.\n   */\n  export function normalizeAreaConfig(\n    parent: DockPanel,\n    area?: DockLayout.AreaConfig | null\n  ): void {\n    if (!area) {\n      return;\n    }\n    if (area.type === 'tab-area') {\n      area.widgets = area.widgets.filter(\n        widget => !widget.isDisposed && widget.parent === parent\n      ) as Widget[];\n      return;\n    }\n    area.children.forEach(child => {\n      normalizeAreaConfig(parent, child);\n    });\n  }\n\n  /**\n   * A class which manages a side bar and related stacked panel.\n   */\n  export class SideBarHandler {\n    /**\n     * Construct a new side bar handler.\n     */\n    constructor(side: string) {\n      this._side = side;\n      this._sideBar = new TabBar<Widget>({\n        insertBehavior: 'none',\n        removeBehavior: 'none',\n        allowDeselect: true\n      });\n      this._stackedPanel = new StackedPanel();\n      this._sideBar.hide();\n      this._stackedPanel.hide();\n      this._lastCurrent = null;\n      this._sideBar.currentChanged.connect(this._onCurrentChanged, this);\n      this._sideBar.tabActivateRequested.connect(\n        this._onTabActivateRequested,\n        this\n      );\n      this._stackedPanel.widgetRemoved.connect(this._onWidgetRemoved, this);\n    }\n\n    /**\n     * Get the tab bar managed by the handler.\n     */\n    get sideBar(): TabBar<Widget> {\n      return this._sideBar;\n    }\n\n    /**\n     * Get the stacked panel managed by the handler\n     */\n    get stackedPanel(): StackedPanel {\n      return this._stackedPanel;\n    }\n\n    /**\n     * Expand the sidebar.\n     *\n     * #### Notes\n     * This will open the most recently used tab, or the first tab\n     * if there is no most recently used.\n     */\n    expand(): void {\n      const previous =\n        this._lastCurrent || (this._items.length > 0 && this._items[0].widget);\n      if (previous) {\n        this.activate(previous.id);\n      }\n    }\n\n    /**\n     * Activate a widget residing in the side bar by ID.\n     *\n     * @param id - The widget's unique ID.\n     */\n    activate(id: string): void {\n      let widget = this._findWidgetByID(id);\n      if (widget) {\n        this._sideBar.currentTitle = widget.title;\n        widget.activate();\n      }\n    }\n\n    /**\n     * Test whether the sidebar has the given widget by id.\n     */\n    has(id: string): boolean {\n      return this._findWidgetByID(id) !== null;\n    }\n\n    /**\n     * Collapse the sidebar so no items are expanded.\n     */\n    collapse(): void {\n      this._sideBar.currentTitle = null;\n    }\n\n    /**\n     * Add a widget and its title to the stacked panel and side bar.\n     *\n     * If the widget is already added, it will be moved.\n     */\n    addWidget(widget: Widget, rank: number): void {\n      widget.parent = null;\n      widget.hide();\n      let item = { widget, rank };\n      let index = this._findInsertIndex(item);\n      ArrayExt.insert(this._items, index, item);\n      this._stackedPanel.insertWidget(index, widget);\n      this._sideBar.insertTab(index, widget.title);\n      this._refreshVisibility();\n    }\n\n    /**\n     * Dehydrate the side bar data.\n     */\n    dehydrate(): ApplicationShell.ISideArea {\n      let collapsed = this._sideBar.currentTitle === null;\n      let widgets = toArray(this._stackedPanel.widgets);\n      let currentWidget = widgets[this._sideBar.currentIndex];\n      return { collapsed, currentWidget, widgets };\n    }\n\n    /**\n     * Rehydrate the side bar.\n     */\n    rehydrate(data: ApplicationShell.ISideArea): void {\n      if (data.currentWidget) {\n        this.activate(data.currentWidget.id);\n      } else if (data.collapsed) {\n        this.collapse();\n      }\n    }\n\n    /**\n     * Find the insertion index for a rank item.\n     */\n    private _findInsertIndex(item: Private.IRankItem): number {\n      return ArrayExt.upperBound(this._items, item, Private.itemCmp);\n    }\n\n    /**\n     * Find the index of the item with the given widget, or `-1`.\n     */\n    private _findWidgetIndex(widget: Widget): number {\n      return ArrayExt.findFirstIndex(this._items, i => i.widget === widget);\n    }\n\n    /**\n     * Find the widget which owns the given title, or `null`.\n     */\n    private _findWidgetByTitle(title: Title<Widget>): Widget | null {\n      let item = find(this._items, value => value.widget.title === title);\n      return item ? item.widget : null;\n    }\n\n    /**\n     * Find the widget with the given id, or `null`.\n     */\n    private _findWidgetByID(id: string): Widget | null {\n      let item = find(this._items, value => value.widget.id === id);\n      return item ? item.widget : null;\n    }\n\n    /**\n     * Refresh the visibility of the side bar and stacked panel.\n     */\n    private _refreshVisibility(): void {\n      this._sideBar.setHidden(this._sideBar.titles.length === 0);\n      this._stackedPanel.setHidden(this._sideBar.currentTitle === null);\n    }\n\n    /**\n     * Handle the `currentChanged` signal from the sidebar.\n     */\n    private _onCurrentChanged(\n      sender: TabBar<Widget>,\n      args: TabBar.ICurrentChangedArgs<Widget>\n    ): void {\n      const oldWidget = args.previousTitle\n        ? this._findWidgetByTitle(args.previousTitle)\n        : null;\n      const newWidget = args.currentTitle\n        ? this._findWidgetByTitle(args.currentTitle)\n        : null;\n      if (oldWidget) {\n        oldWidget.hide();\n      }\n      if (newWidget) {\n        newWidget.show();\n      }\n      this._lastCurrent = newWidget || oldWidget;\n      if (newWidget) {\n        const id = newWidget.id;\n        document.body.setAttribute(`data-${this._side}-sidebar-widget`, id);\n      } else {\n        document.body.removeAttribute(`data-${this._side}-sidebar-widget`);\n      }\n      this._refreshVisibility();\n    }\n\n    /**\n     * Handle a `tabActivateRequest` signal from the sidebar.\n     */\n    private _onTabActivateRequested(\n      sender: TabBar<Widget>,\n      args: TabBar.ITabActivateRequestedArgs<Widget>\n    ): void {\n      args.title.owner.activate();\n    }\n\n    /*\n     * Handle the `widgetRemoved` signal from the stacked panel.\n     */\n    private _onWidgetRemoved(sender: StackedPanel, widget: Widget): void {\n      if (widget === this._lastCurrent) {\n        this._lastCurrent = null;\n      }\n      ArrayExt.removeAt(this._items, this._findWidgetIndex(widget));\n      this._sideBar.removeTab(widget.title);\n      this._refreshVisibility();\n    }\n\n    private _items = new Array<Private.IRankItem>();\n    private _side: string;\n    private _sideBar: TabBar<Widget>;\n    private _stackedPanel: StackedPanel;\n    private _lastCurrent: Widget | null;\n  }\n}\n"]}